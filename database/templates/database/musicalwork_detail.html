{% extends "database/base.html" %}
{% load template_helpers %}
{% block content %}


{% include 'database/detail_title.html' with object=musicalwork %}



<dl class="row">

    {% for contribution in musicalwork.contributions.all|dictsort:"role" %}
        <dt class="col-sm-3">
            {% if contribution.role == 'author' %} Author of Text {% else %} {{ contribution.role|title }}{% endif %}
        </dt> 
        <dd class="col-sm-9">
            <a href="{{contribution.person.get_absolute_url}}">{{ contribution.person }}</a>
        </dd>
        {% if contribution.date %}
            <dt class="col-sm-3">
                Date 
            </dt>
            <dd class="col-sm-9">
                {{ contribution.date }}
            </dd>
        {% endif %}
        {% if contribution.location %}
            <dt class="col-sm-3">
                    Place
            </dt>
            <dd class="col-sm-9">
                <a href="{{contribution.location.get_absolute_url}}">{{ contribution.location.name }}</a>
            </dd>
        {% endif %}
        <dt class="col-sm-3">
            Attribution
        </dt>
        <dd class="col-sm-9">
            {{ contribution.certainty_of_attribution|yesno:"Certain,Uncertain,Not Applicable" }}
        </dd>
    {% endfor %}

    {% if musicalwork.more_titles %}
        <dt class="col-sm-3"> Variant Title{{ musicalwork.more_titles|pluralize}} </dt>
        <dd class="col-sm-9">
            {% for title in musicalwork.more_titles %}
                {{ title }}{% if not forloop.last %},{% endif %}
            {% endfor %}
        </dd>           
    {% endif %}

    {% if musicalwork.genres_as_in_style.exists %}
        <dt class="col-sm-3"> Genre{{ musicalwork.genres_as_in_style.all|pluralize }} as in Style </dt>
        <dd class="col-sm-9">
            {% for style in musicalwork.genres_as_in_style.all %}
                    <a href="{{ style.get_absolute_url }}">{{ style }}</a>{% if not forloop.last %},{% endif %}
            {% endfor %}
        </dd>
    {% endif %}


    {% if musicalwork.genres_as_in_type.exists %}
        <dt class="col-sm-3"> Genre{{ musicalwork.genres_as_in_type.all|pluralize }} as in Type </dt>
        <dd class="col-sm-9">
            {% for type in musicalwork.genres_as_in_type.all %}
                    <a href="{{ type.get_absolute_url }}">{{ type }}</a>{% if not forloop.last %},{% endif %}
            {% endfor %}
        </dd>
    {% endif %}


    <dt class="col-sm-3"> Sacred or Secular </dt>
    <dd class="col-sm-9"> {{ musicalwork.sacred_or_secular|yesno:"Sacred, Secular, Not Applicable"}}

    {% if musicalwork.instrumentation.exists %}
        <dt class="col-sm-3"> Instrumentation </dt>
        <dd class="col-sm-9">
            {% for instrument in musicalwork.instrumentation %}
                    <a href="{{ instrument.get_absolute_url }}">{{ instrument }}</a>{% if not forloop.last %},{% endif %}
            {% endfor %}
        </dd>
    {% endif %}
</dl>


<div class="container">
    <ul class="nav nav-tabs" id="tabs" role="tablist">
        <li class="nav-item">
            <a class="nav-link active" id="sections-tab" data-toggle="tab" href="#sections" role="tab" aria-controls="sections" aria-selected="true">Sections</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" id="parts-tab" data-toggle="tab" href="#parts" role="tab" aria-controls="parts" aria-selected="false">Parts</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" id="files-tab" data-toggle="tab" href="#files" role="tab" aria-controls="files" aria-selected="false">Files</a>
        </li>
    </ul>
    <div class="tab-content" id="tabs-content">
        <div class="tab-pane fade show active" id="sections" role="tabpanel" aria-labelledby="sections-tab">
            <ul>
            {% for section in musicalwork.sections.all|dictsort:"ordering" %}
                <li> <a href="{{ section.get_absolute_url }}"> {{ section }} </a> </li>
            {% endfor %}
            </ul>
        </div>
        <div class="tab-pane fade" id="parts" role="tabpanel" aria-labelledby="parts-tab">
            <ul>
            {% for part in musicalwork.parts.all %}
                <li><a href="{{ part.get_absolute_url }}">{{ part }}</a></li>
            {% endfor %}
            </ul>
            
            <ul>
            {% regroup musicalwork.section_parts|dictsort:"section.ordering" by section as sections %}
            {% for section in sections %}
                <li> {{ section.grouper }} </li>
                <ul>
                {% for part in section.list %} 
                    <li> <a href="{{ part.get_absolute_url}}"> {{ part }} </a> </li>
                {% endfor %}
                </ul>
            {% endfor %}
        </ul>
        </div>
        <div class="tab-pane fade" id="files" role="tabpanel" aria-labelledby="files-tab">
            <div>
                <h4> Files attached to the whole work </h4>
                {% regroup musicalwork.files by get_file_type_display as file_types %}
                <ul>
                    {% for type in file_types %}
                        <li> {{ type.grouper }} File{{ type.list|pluralize }} </li>
                        <ul>
                        {% for file in type.list %} 
                            <li> <a href="{{ file.get_absolute_url}}"> {{ file }} </a> </li>
                        {% endfor %}
                        </ul>
                    {% endfor %}
                </ul>
            </div>

            <div>
                <h4> Files attached to sections </h4>
                <ul>
                {% for section in musicalwork.sections.all|dictsort:"ordering" %}
                    {% if section.files %}
                        <li> {{ section }} </li>
                        {% regroup section.files|dictsort:"file_type" by get_file_type_display as file_types %}
                        <ul>
                            {% for type in file_types %}
                                <li> {{ type.grouper }} File{{ type.list|pluralize }} </li>
                                <ul>
                                {% for file in type.list %} 
                                    <li> <a href="{{ file.get_absolute_url}}"> {{ file }} </a> </li>
                                {% endfor %}
                                </ul>
                            {% endfor %}
                        </ul>
                    {% endif %}
                {% endfor %}
                </ul>
            </div>

            <div>
                <h4> Files attached to parts </h4>
                <ul>
                {% for part in musicalwork.parts.all %}
                    {% if part.files %}
                        <li> {{ part}} </li>
                        {% regroup part.files|dictsort:"file_type" by get_file_type_display as file_types %}
                        <ul>
                            {% for type in file_types %}
                                <li> {{ type.grouper }} File{{ type.list|pluralize }} </li>
                                <ul>
                                {% for file in type.list %} 
                                    <li> <a href="{{ file.get_absolute_url}}"> {{ file }} </a> </li>
                                {% endfor %}
                                </ul>
                            {% endfor %}
                        </ul>
                    {% endif %}
                {% endfor %}
                </ul>

                <ul>
                {% for part in musicalwork.section_parts %}
                    {% if part.files %}
                        <li> {{ part}} </li>
                        {% regroup part.files|dictsort:"file_type" by get_file_type_display as file_types %}
                        <ul>
                            {% for type in file_types %}
                                <li> {{ type.grouper }} File{{ type.list|pluralize }} </li>
                                <ul>
                                {% for file in type.list %} 
                                    <li> <a href="{{ file.get_absolute_url}}"> {{ file }} </a> </li>
                                {% endfor %}
                                </ul>
                            {% endfor %}
                        </ul>
                    {% endif %}
                {% endfor %}
                </ul>
            </div>
        </div>
    </div>
</div>
{% endblock %}
